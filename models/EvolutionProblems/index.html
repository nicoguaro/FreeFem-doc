



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.1.0">
    
    
      
        <title>Evolution problems - FreeFem++</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.11e41852.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.20ef595d.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#mathematical-theory-on-time-difference-approximations" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="FreeFem++" class="md-header-nav__button md-logo">
          
            <img src="../../images/favicon.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                FreeFem++
              </span>
              <span class="md-header-nav__topic">
                Evolution problems
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/FreeFem/FreeFem-doc/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      FreeFem++ on Github
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../.." title="Introduction" class="md-tabs__link">
          Introduction
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../documentation/" title="Documentation" class="md-tabs__link">
          Documentation
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../reference/" title="Language References" class="md-tabs__link">
          Language References
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../tutorials/" title="Tutorials" class="md-tabs__link">
          Tutorials
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../examples/" title="Examples" class="md-tabs__link">
          Examples
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../" title="Models" class="md-tabs__link md-tabs__link--active">
          Models
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="FreeFem++" class="md-nav__button md-logo">
      
        <img src="../../images/favicon.png" width="48" height="48">
      
    </a>
    FreeFem++
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/FreeFem/FreeFem-doc/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      FreeFem++ on Github
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/download/" title="Download" class="md-nav__link">
      Download
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/contributing/" title="How to contribute?" class="md-nav__link">
      How to contribute?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/citation/" title="Citation" class="md-nav__link">
      Citation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/authors/" title="Authors" class="md-nav__link">
      Authors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/Notations/" title="Some Notations" class="md-nav__link">
      Some Notations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/MeshGeneration/" title="Mesh Generation" class="md-nav__link">
      Mesh Generation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/FiniteElement/" title="Finite Element" class="md-nav__link">
      Finite Element
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/Visualization/" title="Visualization" class="md-nav__link">
      Visualization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/AlgorithmsOptimization/" title="Algorithms & Optimization" class="md-nav__link">
      Algorithms & Optimization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/Parallelization/" title="Parallelization" class="md-nav__link">
      Parallelization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-8" type="checkbox" id="nav-2-8">
    
    <label class="md-nav__link" for="nav-2-8">
      ffddm
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-8">
        ffddm
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/ffddm/ffddm/" title="What is ffddm ?" class="md-nav__link">
      What is ffddm ?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/ffddm/tutorial-slides.html" title="Tutorial slides" class="md-nav__link">
      Tutorial slides
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/ffddm/introddm/" title="Introduction to DDM" class="md-nav__link">
      Introduction to DDM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/ffddm/documentation/" title="ffddm Documentation" class="md-nav__link">
      ffddm Documentation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/ffddm/examples/" title="Examples" class="md-nav__link">
      Examples
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/Plugins/" title="Plugins" class="md-nav__link">
      Plugins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/Developers/" title="Developers" class="md-nav__link">
      Developers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Language References
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Language References
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Types/" title="Types" class="md-nav__link">
      Types
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/GlobalVariables/" title="Global variables" class="md-nav__link">
      Global variables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/QuadratureFormulae/" title="Quadrature formulae" class="md-nav__link">
      Quadrature formulae
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Operators/" title="Operators" class="md-nav__link">
      Operators
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Loops/" title="Loops" class="md-nav__link">
      Loops
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/IO/" title="I/O" class="md-nav__link">
      I/O
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Functions/" title="Functions" class="md-nav__link">
      Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/ExternalLibraries/" title="External libraries" class="md-nav__link">
      External libraries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Poisson/" title="Poisson's equation" class="md-nav__link">
      Poisson's equation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/EquationsClassification/" title="Classification of the equations" class="md-nav__link">
      Classification of the equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Membrane/" title="Membrane" class="md-nav__link">
      Membrane
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/HeatExchanger/" title="Heat Exchanger" class="md-nav__link">
      Heat Exchanger
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Acoustics/" title="Acoustics" class="md-nav__link">
      Acoustics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/ThermalConduction/" title="Thermal Conduction" class="md-nav__link">
      Thermal Conduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/FanBlade/" title="Irrotational Fan Blade Flow and Thermal effects" class="md-nav__link">
      Irrotational Fan Blade Flow and Thermal effects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/RotatingHill/" title="Pure convection, The rotating hill" class="md-nav__link">
      Pure convection, The rotating hill
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Elasticity/" title="The system of elasticity" class="md-nav__link">
      The system of elasticity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Stokes/" title="The system of Stokes for fluids" class="md-nav__link">
      The system of Stokes for fluids
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/NavierStokesProjection/" title="A projection Algorithm for the Navier-Stokes equations" class="md-nav__link">
      A projection Algorithm for the Navier-Stokes equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/NavierStokesNewton/" title="Newton method for the steady Navier-Stokes equations" class="md-nav__link">
      Newton method for the steady Navier-Stokes equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/ALargeFluidProblem/" title="A large fluid problem" class="md-nav__link">
      A large fluid problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/ComplexNumbers/" title="An example with complex numbers" class="md-nav__link">
      An example with complex numbers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/OptimalControl/" title="Optimal control" class="md-nav__link">
      Optimal control
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/FlowWithShocks/" title="A flow with shocks" class="md-nav__link">
      A flow with shocks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/HeatEquationOptimization/" title="Time dependent schema optimization for heat equations" class="md-nav__link">
      Time dependent schema optimization for heat equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/TimeDependentStokes/" title="A transient Stokes solver in matrix form" class="md-nav__link">
      A transient Stokes solver in matrix form
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/WifiPropagation/" title="Wifi Propagation" class="md-nav__link">
      Wifi Propagation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/MatlabOctavePlot/" title="Matlab / Octave Plots" class="md-nav__link">
      Matlab / Octave Plots
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Examples
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Examples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Models
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Models
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../StaticProblems/" title="Static problems" class="md-nav__link">
      Static problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Elasticity/" title="Elasticity" class="md-nav__link">
      Elasticity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../NonLinearStaticProblems/" title="Non-linear static problems" class="md-nav__link">
      Non-linear static problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../EigenValueProblems/" title="Eigenvalue problems" class="md-nav__link">
      Eigenvalue problems
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Evolution problems
      </label>
    
    <a href="./" title="Evolution problems" class="md-nav__link md-nav__link--active">
      Evolution problems
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mathematical-theory-on-time-difference-approximations" title="Mathematical Theory on Time Difference Approximations." class="md-nav__link">
    Mathematical Theory on Time Difference Approximations.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#convection" title="Convection" class="md-nav__link">
    Convection
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2d-black-scholes-equation-for-an-european-put-option" title="2D Black-Scholes equation for an European Put option" class="md-nav__link">
    2D Black-Scholes equation for an European Put option
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" title="References" class="md-nav__link">
    References
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../NavierStokesEquations/" title="Navier-Stokes equations" class="md-nav__link">
      Navier-Stokes equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../VariationalInequality/" title="Variational inequality" class="md-nav__link">
      Variational inequality
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../DomainDecomposition/" title="Domain decomposition" class="md-nav__link">
      Domain decomposition
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FluidStructureCoupledProblem/" title="Fluid-Structure coupled problem" class="md-nav__link">
      Fluid-Structure coupled problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../TransmissionProblem/" title="Transmission problem" class="md-nav__link">
      Transmission problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FreeBoundaryProblem/" title="Free boundary problem" class="md-nav__link">
      Free boundary problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../NonLinearElasticity/" title="Non-linear elasticity" class="md-nav__link">
      Non-linear elasticity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CompressibleNeoHookeanMaterials/" title="Compressible Neo-Hookean materials" class="md-nav__link">
      Compressible Neo-Hookean materials
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../WhisperingGalleryModes/" title="Whispering gallery modes" class="md-nav__link">
      Whispering gallery modes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mathematical-theory-on-time-difference-approximations" title="Mathematical Theory on Time Difference Approximations." class="md-nav__link">
    Mathematical Theory on Time Difference Approximations.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#convection" title="Convection" class="md-nav__link">
    Convection
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2d-black-scholes-equation-for-an-european-put-option" title="2D Black-Scholes equation for an European Put option" class="md-nav__link">
    2D Black-Scholes equation for an European Put option
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" title="References" class="md-nav__link">
    References
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/FreeFem/FreeFem-doc/edit/master/docs/models/EvolutionProblems.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Evolution problems</h1>
                
                <p>FreeFem++ also solves evolution problems such as the heat equation:</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray}
    \frac{\p u}{\p t}-\mu\Delta u &amp;=&amp; f &amp; \textrm{ in }\Omega\times ]0,T[\label{eqn::heatequation}\\
    u(\mathbf{x},0) &amp;=&amp; u_0(\mathbf{x}) &amp; \textrm{ in }\Omega\\
    \left(\p u/\p n\right)(\mathbf{x},t) &amp;=&amp; 0 &amp; \textrm{ on }\p\Omega\times ]0,T[
\end{eqnarray}</div>
<script type="math/tex; mode=display">\begin{eqnarray}
    \frac{\p u}{\p t}-\mu\Delta u &=& f & \textrm{ in }\Omega\times ]0,T[\label{eqn::heatequation}\\
    u(\mathbf{x},0) &=& u_0(\mathbf{x}) & \textrm{ in }\Omega\\
    \left(\p u/\p n\right)(\mathbf{x},t) &=& 0 & \textrm{ on }\p\Omega\times ]0,T[
\end{eqnarray}</script>
</div>
<p>with a positive viscosity coefficient <span><span class="MathJax_Preview">\mu</span><script type="math/tex">\mu</script></span> and homogeneous Neumann boundary conditions.</p>
<p>We solve \eqref{eqn::heatequation} by FEM in space and finite differences in time.</p>
<p>We use the definition of the partial derivative of the solution in the time derivative,</p>
<div>
<div class="MathJax_Preview">
\frac{\p u}{\p t}(x,y,t) = \lim_{\tau \to 0}\frac{u(x,y,t)-u(x,y,t-\tau )}{\tau }
</div>
<script type="math/tex; mode=display">
\frac{\p u}{\p t}(x,y,t) = \lim_{\tau \to 0}\frac{u(x,y,t)-u(x,y,t-\tau )}{\tau }
</script>
</div>
<p>which indicates that <span><span class="MathJax_Preview">u^m(x,y)=u(x,y,m\tau )</span><script type="math/tex">u^m(x,y)=u(x,y,m\tau )</script></span> will satisfy approximatively</p>
<div>
<div class="MathJax_Preview">
\frac{\p u}{\p t}(x,y,m\tau )\simeq \frac{u^m(x,y)-u^{m-1}(x,y)}{\tau }
</div>
<script type="math/tex; mode=display">
\frac{\p u}{\p t}(x,y,m\tau )\simeq \frac{u^m(x,y)-u^{m-1}(x,y)}{\tau }
</script>
</div>
<p>The time discretization of heat equation \eqref{eqn::heatequation} is as follows, <span><span class="MathJax_Preview">\forall m=0,\cdots,[T/\tau ]</span><script type="math/tex">\forall m=0,\cdots,[T/\tau ]</script></span>:</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray}
    \frac{u^{m+1}-u^{m}}{\tau }-\mu\Delta u^{m+1} &amp;=&amp; f^{m+1} &amp; \textrm{ in }\Omega\\
    u^0(\mathbf{x}) &amp;=&amp; u_0(\mathbf{x}) &amp; \textrm{ in }\Omega\\
    \p u^{m+1}/\p n(\mathbf{x}) &amp;=&amp; 0 &amp; \textrm{ on }\p\Omega
\end{eqnarray}</div>
<script type="math/tex; mode=display">\begin{eqnarray}
    \frac{u^{m+1}-u^{m}}{\tau }-\mu\Delta u^{m+1} &=& f^{m+1} & \textrm{ in }\Omega\\
    u^0(\mathbf{x}) &=& u_0(\mathbf{x}) & \textrm{ in }\Omega\\
    \p u^{m+1}/\p n(\mathbf{x}) &=& 0 & \textrm{ on }\p\Omega
\end{eqnarray}</script>
</div>
<p>which is so-called <em>backward Euler method</em> for \eqref{eqn::heatequation}.</p>
<p>To obtain the variational formulation, multiply with the test function <span><span class="MathJax_Preview">v</span><script type="math/tex">v</script></span> both sides of the equation:</p>
<div>
<div class="MathJax_Preview">\begin{equation*}
\int_{\Omega}\{u^{m+1}v-\tau \Delta u^{m+1}v\}=\int_{\Omega}\{u^m+\tau f^{m+1}\}v
\end{equation*}</div>
<script type="math/tex; mode=display">\begin{equation*}
\int_{\Omega}\{u^{m+1}v-\tau \Delta u^{m+1}v\}=\int_{\Omega}\{u^m+\tau f^{m+1}\}v
\end{equation*}</script>
</div>
<p>By the divergence theorem, we have</p>
<div>
<div class="MathJax_Preview">\begin{equation*}
    \int_{\Omega}\{u^{m+1}v+\tau\nabla u^{m+1}\cdot \nabla v\}
    -\int_{\p\Omega} \tau \left( \p u^{m+1}/\p n\right) v
    =\int_{\Omega }\{u^mv+\tau f^{m+1}v\}
\end{equation*}</div>
<script type="math/tex; mode=display">\begin{equation*}
    \int_{\Omega}\{u^{m+1}v+\tau\nabla u^{m+1}\cdot \nabla v\}
    -\int_{\p\Omega} \tau \left( \p u^{m+1}/\p n\right) v
    =\int_{\Omega }\{u^mv+\tau f^{m+1}v\}
\end{equation*}</script>
</div>
<p>By the boundary condition <span><span class="MathJax_Preview">\p u^{m+1}/\p n=0</span><script type="math/tex">\p u^{m+1}/\p n=0</script></span>, it follows that</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    \int_{\Omega} \{u^{m+1}v+\tau \nabla u^{m+1}\cdot \nabla v\}
    -\int_{\Omega }\{u^mv+\tau f^{m+1}v\}
    =0
    \label{eqn::heatequationBWE}
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    \int_{\Omega} \{u^{m+1}v+\tau \nabla u^{m+1}\cdot \nabla v\}
    -\int_{\Omega }\{u^mv+\tau f^{m+1}v\}
    =0
    \label{eqn::heatequationBWE}
\end{equation}</script>
</div>
<p>Using the identity just above, we can calculate the finite element approximation <span><span class="MathJax_Preview">u_h^m</span><script type="math/tex">u_h^m</script></span> of <span><span class="MathJax_Preview">u^m</span><script type="math/tex">u^m</script></span> in a step-by-step manner with respect to <span><span class="MathJax_Preview">t</span><script type="math/tex">t</script></span>.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>We now solve the following example with the exact solution <span><span class="MathJax_Preview">u(x,y,t)=tx^4</span><script type="math/tex">u(x,y,t)=tx^4</script></span>, \Omega = ]0,1[^2.</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray*}
    \frac{{\p u}}{{\p t}} - \mu \Delta u &amp;=&amp; x^4 - \mu 12tx^2 &amp; \textrm{ in }\Omega\times ]0,3[\\
    u(x,y,0) &amp;=&amp; 0 &amp; \textrm{ on }\Omega\\
    \left. u \right|_{\p\Omega} &amp;=&amp; t*x^4
\end{eqnarray*}</div>
<script type="math/tex; mode=display">\begin{eqnarray*}
    \frac{{\p u}}{{\p t}} - \mu \Delta u &=& x^4 - \mu 12tx^2 & \textrm{ in }\Omega\times ]0,3[\\
    u(x,y,0) &=& 0 & \textrm{ on }\Omega\\
    \left. u \right|_{\p\Omega} &=& t*x^4
\end{eqnarray*}</script>
</div>
<!--- __ --->

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// Parameters</span>
<span class="kt">real</span> <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">mu</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">;</span>

<span class="c1">// Mesh</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>

<span class="c1">// Fespace</span>
<span class="kt">fespace</span> <span class="nf">Vh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
<span class="n">Vh</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">;</span>

<span class="c1">// Problem</span>
<span class="kt">problem</span> <span class="nf">dHeat</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="n">u</span><span class="o">*</span><span class="n">v</span>
        <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="n">mu</span><span class="o">*</span><span class="p">(</span><span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
        <span class="o">-</span> <span class="n">uu</span><span class="o">*</span><span class="n">v</span>
        <span class="o">-</span> <span class="n">dt</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="n">v</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">g</span><span class="p">)</span>
    <span class="p">;</span>

<span class="c1">// Time loop</span>
<span class="kt">real</span> <span class="kp">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">uu</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="kr">m</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="kr">m</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="o">/</span><span class="n">dt</span><span class="p">;</span> <span class="kr">m</span><span class="o">++</span><span class="p">){</span>
    <span class="c1">// Update</span>
    <span class="kp">t</span> <span class="o">=</span> <span class="kp">t</span><span class="o">+</span><span class="n">dt</span><span class="p">;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="kr">x</span><span class="o">^</span><span class="mi">4</span> <span class="o">-</span> <span class="n">mu</span><span class="o">*</span><span class="kp">t</span><span class="o">*</span><span class="mi">12</span><span class="o">*</span><span class="kr">x</span><span class="o">^</span><span class="mi">2</span><span class="p">;</span>
    <span class="n">g</span> <span class="o">=</span> <span class="kp">t</span><span class="o">*</span><span class="kr">x</span><span class="o">^</span><span class="mi">4</span><span class="p">;</span>
    <span class="n">uu</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>

    <span class="c1">// Solve</span>
    <span class="n">dHeat</span><span class="p">;</span>

    <span class="c1">// Plot</span>
    <span class="nf">plot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;t=&quot;</span> <span class="o">&lt;&lt;</span> <span class="kp">t</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; - L^2-Error=&quot;</span> <span class="o">&lt;&lt;</span> <span class="nf">sqrt</span><span class="p">(</span><span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)((</span><span class="n">u</span><span class="o">-</span><span class="kp">t</span><span class="o">*</span><span class="kr">x</span><span class="o">^</span><span class="mi">4</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>In the last statement, the <span><span class="MathJax_Preview">L^2</span><script type="math/tex">L^2</script></span>-error <span><span class="MathJax_Preview">\left(\int_{\Omega}\left| u-tx^4\right|^2\right)^{1/2}</span><script type="math/tex">\left(\int_{\Omega}\left| u-tx^4\right|^2\right)^{1/2}</script></span> is calculated at <span><span class="MathJax_Preview">t=m\tau, \tau =0.1</span><script type="math/tex">t=m\tau, \tau =0.1</script></span>. At <span><span class="MathJax_Preview">t=0.1</span><script type="math/tex">t=0.1</script></span>, the error is 0.000213269. The errors increase with <span><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span> and 0.00628589 at <span><span class="MathJax_Preview">t=3</span><script type="math/tex">t=3</script></span>.</p>
<p>The iteration of the backward Euler \eqref{eqn::heatequationBWE} is made by <a href="/reference/Loops/#for"><code class="codehilite"><span class="k">for</span></code> loop</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The stiffness matrix in the loop is used over and over again. FreeFem++ support reuses of stiffness matrix.</p>
</div>
</div>
<h2 id="mathematical-theory-on-time-difference-approximations">Mathematical Theory on Time Difference Approximations.<a class="headerlink" href="#mathematical-theory-on-time-difference-approximations" title="Permanent link">#</a></h2>
<p>In this section, we show the advantage of implicit schemes. Let <span><span class="MathJax_Preview">V, H</span><script type="math/tex">V, H</script></span> be separable Hilbert space and <span><span class="MathJax_Preview">V</span><script type="math/tex">V</script></span> is dense in <span><span class="MathJax_Preview">H</span><script type="math/tex">H</script></span>. Let <span><span class="MathJax_Preview">a</span><script type="math/tex">a</script></span> be a continuous bilinear form over <span><span class="MathJax_Preview">V \times V</span><script type="math/tex">V \times V</script></span> with coercivity and symmetry.</p>
<p>Then <span><span class="MathJax_Preview">\sqrt{a(v,v)}</span><script type="math/tex">\sqrt{a(v,v)}</script></span> become equivalent to the norm <span><span class="MathJax_Preview">\| v\|</span><script type="math/tex">\| v\|</script></span> of <span><span class="MathJax_Preview">V</span><script type="math/tex">V</script></span>.</p>
<p><strong>Problem Ev<span><span class="MathJax_Preview">(f,\Omega)</span><script type="math/tex">(f,\Omega)</script></span></strong>: For a given <span><span class="MathJax_Preview">f\in L^2(0,T;V'),\, u^0\in H</span><script type="math/tex">f\in L^2(0,T;V'),\, u^0\in H</script></span></p>
<div>
<div class="MathJax_Preview">\begin{eqnarray}
\frac{d}{dt}(u(t),v)+a(u(t),v)&amp;=&amp;( f(t),v)\qquad \forall v\in V,\quad a.e. \, t\in [0,T]\\
u(0)&amp;=&amp;u^0\nonumber
\end{eqnarray}</div>
<script type="math/tex; mode=display">\begin{eqnarray}
\frac{d}{dt}(u(t),v)+a(u(t),v)&=&( f(t),v)\qquad \forall v\in V,\quad a.e. \, t\in [0,T]\\
u(0)&=&u^0\nonumber
\end{eqnarray}</script>
</div>
<p>where <span><span class="MathJax_Preview">V'</span><script type="math/tex">V'</script></span> is the dual space of <span><span class="MathJax_Preview">V</span><script type="math/tex">V</script></span>.</p>
<p>Then, there is an unique solution <span><span class="MathJax_Preview">u\in L^{\infty}(0,T;H)\cap L^2(0,T;V)</span><script type="math/tex">u\in L^{\infty}(0,T;H)\cap L^2(0,T;V)</script></span>.</p>
<p>Let us denote the time step by <span><span class="MathJax_Preview">\tau&gt;0</span><script type="math/tex">\tau>0</script></span>, <span><span class="MathJax_Preview">N_T=[T/\tau]</span><script type="math/tex">N_T=[T/\tau]</script></span>. For the discretization, we put <span><span class="MathJax_Preview">u^n = u(n\tau)</span><script type="math/tex">u^n = u(n\tau)</script></span> and consider the time difference for each <span><span class="MathJax_Preview">\theta\in [0,1]</span><script type="math/tex">\theta\in [0,1]</script></span></p>
<div>
<div class="MathJax_Preview">\begin{eqnarray}
\label{eqn::t-method}
\frac{1}{\tau}\left( u_h^{n+1}-u_h^n,\phi_i\right)
+a\left( u_h^{n+\theta},\phi_i\right)=\langle f^{n+\theta},\phi_i\rangle\\
i=1,\cdots, m,\quad n=0,\cdots, N_T\nonumber\\
u_h^{n+\theta}=\theta u_h^{n+1}+(1-\theta)u_h^n,\quad
f^{n+\theta}=\theta f^{n+1}+(1-\theta)f^n\nonumber
\end{eqnarray}</div>
<script type="math/tex; mode=display">\begin{eqnarray}
\label{eqn::t-method}
\frac{1}{\tau}\left( u_h^{n+1}-u_h^n,\phi_i\right)
+a\left( u_h^{n+\theta},\phi_i\right)=\langle f^{n+\theta},\phi_i\rangle\\
i=1,\cdots, m,\quad n=0,\cdots, N_T\nonumber\\
u_h^{n+\theta}=\theta u_h^{n+1}+(1-\theta)u_h^n,\quad
f^{n+\theta}=\theta f^{n+1}+(1-\theta)f^n\nonumber
\end{eqnarray}</script>
</div>
<p>Formula \eqref{eqn::t-method} is the <em>forward Euler scheme</em> if <span><span class="MathJax_Preview">\theta=0</span><script type="math/tex">\theta=0</script></span>, <em>Crank-Nicolson scheme</em> if <span><span class="MathJax_Preview">\theta=1/2</span><script type="math/tex">\theta=1/2</script></span>, the <em>backward Euler scheme</em> if <span><span class="MathJax_Preview">\theta=1</span><script type="math/tex">\theta=1</script></span>.</p>
<p>Unknown vectors <span><span class="MathJax_Preview">u^n=(u_h^1,\cdots,u_h^M)^T</span><script type="math/tex">u^n=(u_h^1,\cdots,u_h^M)^T</script></span> in</p>
<div>
<div class="MathJax_Preview">
u_h^n(x)=u^n_1\phi_1(x)+\cdots+u^n_m\phi_m(x),\quad u^n_1,\cdots,u^n_m\in \R
</div>
<script type="math/tex; mode=display">
u_h^n(x)=u^n_1\phi_1(x)+\cdots+u^n_m\phi_m(x),\quad u^n_1,\cdots,u^n_m\in \R
</script>
</div>
<p>are obtained from solving the matrix</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray}
\label{eqn::Evolution-1}
(M+\theta\tau A)u^{n+1}=\{M-(1-\theta)\tau A\}u^n
+\tau\left\{\theta f^{n+1}+(1-\theta)f^n\right\}\\
M=(m_{ij}),\quad m_{ij}=(\phi_j,\phi_i),\qquad
A=(a_{ij}),\quad a_{ij}=a(\phi_j,\phi_i)\nonumber
\end{eqnarray}</div>
<script type="math/tex; mode=display">\begin{eqnarray}
\label{eqn::Evolution-1}
(M+\theta\tau A)u^{n+1}=\{M-(1-\theta)\tau A\}u^n
+\tau\left\{\theta f^{n+1}+(1-\theta)f^n\right\}\\
M=(m_{ij}),\quad m_{ij}=(\phi_j,\phi_i),\qquad
A=(a_{ij}),\quad a_{ij}=a(\phi_j,\phi_i)\nonumber
\end{eqnarray}</script>
</div>
<p>Refer <a href="#TABATA1994">TABATA1994</a>, pp.70--75 for solvability of \eqref{eqn::Evolution-1}. The stability of \eqref{eqn::Evolution-1} is in <a href="#TABATA1994">TABATA1994</a>, Theorem 2.13:</p>
<p>Let <span><span class="MathJax_Preview">\{\mathcal{T}_h\}_{h\downarrow 0}</span><script type="math/tex">\{\mathcal{T}_h\}_{h\downarrow 0}</script></span> be regular triangulations (see <a href="/documentation/MeshGeneration/#regular-triangulation-htriangle">Regular Triangulation</a>). Then there is a number <span><span class="MathJax_Preview">c_0&gt;0</span><script type="math/tex">c_0>0</script></span> independent of <span><span class="MathJax_Preview">h</span><script type="math/tex">h</script></span> such that,</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray}
|u_h^n|^2\le
\left\{
\begin{array}{lr}
\frac{1}{\delta}\left\{
|u^0_h|^2+\tau \sum_{k=0}^{n-1}\|f^{k+\theta}\|^2_{V_h'}
\right\}&amp;\theta\in [0,1/2)\\
|u^0_h|^2+\tau \sum_{k=0}^{n-1}\|f^{k+\theta}\|^2_{V_h'}&amp;\theta\in [1/2,1]
\end{array}
\right.
\end{eqnarray}</div>
<script type="math/tex; mode=display">\begin{eqnarray}
|u_h^n|^2\le
\left\{
\begin{array}{lr}
\frac{1}{\delta}\left\{
|u^0_h|^2+\tau \sum_{k=0}^{n-1}\|f^{k+\theta}\|^2_{V_h'}
\right\}&\theta\in [0,1/2)\\
|u^0_h|^2+\tau \sum_{k=0}^{n-1}\|f^{k+\theta}\|^2_{V_h'}&\theta\in [1/2,1]
\end{array}
\right.
\end{eqnarray}</script>
</div>
<p>if the following are satisfied:</p>
<ol>
<li>
<p>When <span><span class="MathJax_Preview">\theta\in [0,1/2)</span><script type="math/tex">\theta\in [0,1/2)</script></span>, then we can take a time step <span><span class="MathJax_Preview">\tau</span><script type="math/tex">\tau</script></span> in such a way that</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray}
\tau &lt;\frac{2(1-\delta)}{(1-2\theta)c_0^2}h^2
\end{eqnarray}</div>
<script type="math/tex; mode=display">\begin{eqnarray}
\tau <\frac{2(1-\delta)}{(1-2\theta)c_0^2}h^2
\end{eqnarray}</script>
</div>
<p>for arbitrary <span><span class="MathJax_Preview">\delta\in (0,1)</span><script type="math/tex">\delta\in (0,1)</script></span>.</p>
</li>
<li>
<p>When <span><span class="MathJax_Preview">1/2\leq \theta\leq 1</span><script type="math/tex">1/2\leq \theta\leq 1</script></span>, we can take <span><span class="MathJax_Preview">\tau</span><script type="math/tex">\tau</script></span> arbitrary.</p>
</li>
</ol>
<div class="admonition example">
<p class="admonition-title">Example</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// Parameters</span>
<span class="kt">real</span> <span class="n">tau</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">theta</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>

<span class="c1">// Mesh</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>

<span class="c1">// Fespace</span>
<span class="kt">fespace</span> <span class="nf">Vh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
<span class="n">Vh</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">oldU</span><span class="p">;</span>
<span class="n">Vh</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f0</span><span class="p">;</span>

<span class="kt">fespace</span> <span class="nf">Ph</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P0</span><span class="p">);</span>
<span class="n">Ph</span> <span class="n">h</span> <span class="o">=</span> <span class="kr">hTriangle</span><span class="p">;</span> <span class="c1">// mesh sizes for each triangle</span>

<span class="c1">// Function</span>
<span class="kt">func</span> <span class="kt">real</span> <span class="nf">f</span> <span class="p">(</span><span class="kt">real</span> <span class="kp">t</span><span class="p">){</span>
    <span class="k">return</span> <span class="kr">x</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="kr">x</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="kp">t</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">12</span><span class="o">*</span><span class="kr">x</span> <span class="o">-</span> <span class="mi">11</span><span class="o">*</span><span class="kr">x</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="kr">x</span><span class="o">^</span><span class="mi">3</span> <span class="o">+</span> <span class="kr">x</span><span class="o">^</span><span class="mi">4</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// File</span>
<span class="kt">ofstream</span> <span class="nf">out</span><span class="p">(</span><span class="s">&quot;err02.csv&quot;</span><span class="p">);</span> <span class="c1">//file to store calculations</span>
<span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;mesh size = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">h</span><span class="p">[].</span><span class="kr">max</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, time step = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">tau</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="kr">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="kr">n</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">/</span><span class="n">tau</span><span class="p">;</span> <span class="kr">n</span><span class="o">++</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="kr">n</span><span class="o">*</span><span class="n">tau</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;,&quot;</span><span class="p">;</span>
<span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

<span class="c1">// Problem</span>
<span class="kt">problem</span> <span class="nf">aTau</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="n">u</span><span class="o">*</span><span class="n">v</span>
        <span class="o">+</span> <span class="n">theta</span><span class="o">*</span><span class="n">tau</span><span class="o">*</span><span class="p">(</span><span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="n">u</span><span class="o">*</span><span class="n">v</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">-</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="n">oldU</span><span class="o">*</span><span class="n">v</span>
        <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">tau</span><span class="o">*</span><span class="p">(</span><span class="nf">dx</span><span class="p">(</span><span class="n">oldU</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">oldU</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="n">oldU</span><span class="o">*</span><span class="n">v</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">-</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="n">tau</span><span class="o">*</span><span class="p">(</span><span class="n">theta</span><span class="o">*</span><span class="n">f1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">f0</span><span class="p">)</span><span class="o">*</span><span class="n">v</span>
    <span class="p">)</span>
    <span class="p">;</span>

<span class="c1">// Theta loop</span>
<span class="k">while</span> <span class="p">(</span><span class="n">theta</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">){</span>
    <span class="kt">real</span> <span class="kp">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">real</span> <span class="n">T</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="n">oldU</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="n">theta</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;,&quot;</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="kr">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="kr">n</span> <span class="o">&lt;</span> <span class="n">T</span><span class="o">/</span><span class="n">tau</span><span class="p">;</span> <span class="kr">n</span><span class="o">++</span><span class="p">){</span>
        <span class="c1">// Update</span>
        <span class="kp">t</span> <span class="o">=</span> <span class="kp">t</span> <span class="o">+</span> <span class="n">tau</span><span class="p">;</span>
        <span class="n">f0</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="kr">n</span><span class="o">*</span><span class="n">tau</span><span class="p">);</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">f</span><span class="p">((</span><span class="kr">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">tau</span><span class="p">);</span>

        <span class="c1">// Solve</span>
        <span class="n">aTau</span><span class="p">;</span>
        <span class="n">oldU</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>

        <span class="c1">// Plot</span>
        <span class="nf">plot</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>

        <span class="c1">// Error</span>
        <span class="n">Vh</span> <span class="n">uex</span> <span class="o">=</span> <span class="kp">t</span><span class="o">*</span><span class="kr">x</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="kr">x</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="p">;</span> <span class="c1">//exact solution = tx^2(1-x)^2</span>
        <span class="n">Vh</span> <span class="kp">err</span> <span class="o">=</span> <span class="n">u</span> <span class="o">-</span> <span class="n">uex</span><span class="p">;</span> <span class="c1">// err = FE-sol - exact</span>
        <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="nf">abs</span><span class="p">(</span><span class="kp">err</span><span class="p">[].</span><span class="kr">max</span><span class="p">)</span><span class="o">/</span><span class="nf">abs</span><span class="p">(</span><span class="n">uex</span><span class="p">[].</span><span class="kr">max</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;,&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<table>
<thead>
<tr>
<th align="center"><a name="Fig19">Fig. 19</a>: <span><span class="MathJax_Preview">\max_{x\in\Omega}\vert u_h^n(\theta)-u_{ex}(n\tau)\vert\max_{x\in\Omega}\vert u_{ex}(n\tau)\vert</span><script type="math/tex">\max_{x\in\Omega}\vert u_h^n(\theta)-u_{ex}(n\tau)\vert\max_{x\in\Omega}\vert u_{ex}(n\tau)\vert</script></span> at <span><span class="MathJax_Preview">n=0,1,\cdots,29</span><script type="math/tex">n=0,1,\cdots,29</script></span></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="TimeDifference" src="../images/EvolutionProblems_TimeDifference.png" /></td>
</tr>
</tbody>
</table>
<p>We can see in <a href="#Fig19">Fig. 19</a> that <span><span class="MathJax_Preview">u_h^n(\theta)</span><script type="math/tex">u_h^n(\theta)</script></span> become unstable at <span><span class="MathJax_Preview">\theta=0.4</span><script type="math/tex">\theta=0.4</script></span>, and figures are omitted in the case <span><span class="MathJax_Preview">\theta&lt;0.4</span><script type="math/tex">\theta<0.4</script></span>.</p>
</div>
<h2 id="convection">Convection<a class="headerlink" href="#convection" title="Permanent link">#</a></h2>
<p>The hyperbolic equation</p>
<div>
<div class="MathJax_Preview">\begin{equation}
\label{eqn::conv}
\p_t u +\mathbf{\alpha} \cdot \nabla u=f;\ \textrm{ for a vector-valued function }\mathbf{\alpha}
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
\label{eqn::conv}
\p_t u +\mathbf{\alpha} \cdot \nabla u=f;\ \textrm{ for a vector-valued function }\mathbf{\alpha}
\end{equation}</script>
</div>
<p>appears frequently in scientific problems, for example in the Navier-Stokes equations, in the Convection-Diffusion equation, etc.</p>
<p>In the case of 1-dimensional space, we can easily find the general solution <span><span class="MathJax_Preview">(x,t)\mapsto u(x,t)=u^0(x-\alpha t)</span><script type="math/tex">(x,t)\mapsto u(x,t)=u^0(x-\alpha t)</script></span> of the following equation, if <span><span class="MathJax_Preview">\alpha</span><script type="math/tex">\alpha</script></span> is constant,</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray}
    \label{eqn::conv0}
    \p_t u +\alpha\p_x u &amp;=&amp; 0\\
    u(x,0) &amp;=&amp; u^0(x),
\end{eqnarray}</div>
<script type="math/tex; mode=display">\begin{eqnarray}
    \label{eqn::conv0}
    \p_t u +\alpha\p_x u &=& 0\\
    u(x,0) &=& u^0(x),
\end{eqnarray}</script>
</div>
<p>because <span><span class="MathJax_Preview">\p_t u +\alpha\p_x u=-\alpha\dot{u}^0+a\dot{u}^0=0</span><script type="math/tex">\p_t u +\alpha\p_x u=-\alpha\dot{u}^0+a\dot{u}^0=0</script></span>, where <span><span class="MathJax_Preview">\dot{u}^0=du^0(x)/dx</span><script type="math/tex">\dot{u}^0=du^0(x)/dx</script></span>.</p>
<p>Even if <span><span class="MathJax_Preview">\alpha</span><script type="math/tex">\alpha</script></span> is not constant, the construction works on similar principles. One begins with the ordinary differential equation (with the convention that <span><span class="MathJax_Preview">\alpha</span><script type="math/tex">\alpha</script></span> is prolonged by zero apart from <span><span class="MathJax_Preview">(0,L)\times (0,T)</span><script type="math/tex">(0,L)\times (0,T)</script></span>):</p>
<div>
<div class="MathJax_Preview">
\dot{X}(\tau )=+\alpha(X(\tau ),\tau ),\ \tau \in (0,t)\quad X(t)=x
</div>
<script type="math/tex; mode=display">
\dot{X}(\tau )=+\alpha(X(\tau ),\tau ),\ \tau \in (0,t)\quad X(t)=x
</script>
</div>
<p>In this equation <span><span class="MathJax_Preview">\tau</span><script type="math/tex">\tau</script></span> is the variable and <span><span class="MathJax_Preview">x,t</span><script type="math/tex">x,t</script></span> are parameters, and we denote the solution by <span><span class="MathJax_Preview">X_{x,t}(\tau )</span><script type="math/tex">X_{x,t}(\tau )</script></span>. Then it is noticed that <span><span class="MathJax_Preview">(x,t)\rightarrow v(X(\tau),\tau)</span><script type="math/tex">(x,t)\rightarrow v(X(\tau),\tau)</script></span> in <span><span class="MathJax_Preview">\tau=t</span><script type="math/tex">\tau=t</script></span> satisfies the equation</p>
<div>
<div class="MathJax_Preview">
\p _{t}v+\alpha\p _{x}v=\p _{t}X\dot{v}+a\p _{x}X\dot{v}%
=0
</div>
<script type="math/tex; mode=display">
\p _{t}v+\alpha\p _{x}v=\p _{t}X\dot{v}+a\p _{x}X\dot{v}%
=0
</script>
</div>
<!--- __ -->

<p>and by the definition <span><span class="MathJax_Preview">\p _{t}X=\dot{X}=+\alpha</span><script type="math/tex">\p _{t}X=\dot{X}=+\alpha</script></span> and <span><span class="MathJax_Preview">\p_{x}X=\p _{x}x</span><script type="math/tex">\p_{x}X=\p _{x}x</script></span> in <span><span class="MathJax_Preview">\tau=t</span><script type="math/tex">\tau=t</script></span>, because if <span><span class="MathJax_Preview">\tau =t</span><script type="math/tex">\tau =t</script></span> we have <span><span class="MathJax_Preview">X(\tau )=x</span><script type="math/tex">X(\tau )=x</script></span>.</p>
<p>The general solution of \eqref{eqn::conv0} is thus the value of the boundary condition in <span><span class="MathJax_Preview">X_{x, t}(0)</span><script type="math/tex">X_{x, t}(0)</script></span>, that is to say <span><span class="MathJax_Preview">u(x,t)=u^{0}(X_{x,t}(0))</span><script type="math/tex">u(x,t)=u^{0}(X_{x,t}(0))</script></span> where <span><span class="MathJax_Preview">X_{x,t}(0)</span><script type="math/tex">X_{x,t}(0)</script></span> is on the <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> axis, <span><span class="MathJax_Preview">u(x,t)=u^{0}(X_{x,t}(0))</span><script type="math/tex">u(x,t)=u^{0}(X_{x,t}(0))</script></span> if <span><span class="MathJax_Preview">X_{x,t}(0)</span><script type="math/tex">X_{x,t}(0)</script></span> is on the axis of <span><span class="MathJax_Preview">t</span><script type="math/tex">t</script></span>.</p>
<p>In higher dimension <span><span class="MathJax_Preview">\Omega \subset R^{d},~d=2,3</span><script type="math/tex">\Omega \subset R^{d},~d=2,3</script></span>, the equation for the convection is written</p>
<div>
<div class="MathJax_Preview">
\p _{t}u+\mathbf{\alpha}\cdot \nabla u=0\hbox{ in }\Omega \times (0,T)
</div>
<script type="math/tex; mode=display">
\p _{t}u+\mathbf{\alpha}\cdot \nabla u=0\hbox{ in }\Omega \times (0,T)
</script>
</div>
<!--- __ --->

<p>where <span><span class="MathJax_Preview">\mathbf{a}(x,t)\in R^{d}</span><script type="math/tex">\mathbf{a}(x,t)\in R^{d}</script></span>.</p>
<p>FreeFem++ implements the Characteristic-Galerkin method for convection operators. Recall that the equation \eqref{eqn::conv} can be discretized as</p>
<div>
<div class="MathJax_Preview">
\frac{Du}{Dt} = f\;\;\textrm{i.e. }\frac{du}{dt}\left( {X(t),t} \right) = f\left(X( t ),t \right)\textrm{ where }\frac{dX}{dt}( t ) = \mathbf{\alpha}( {X(t),t})
</div>
<script type="math/tex; mode=display">
\frac{Du}{Dt} = f\;\;\textrm{i.e. }\frac{du}{dt}\left( {X(t),t} \right) = f\left(X( t ),t \right)\textrm{ where }\frac{dX}{dt}( t ) = \mathbf{\alpha}( {X(t),t})
</script>
</div>
<p>where <span><span class="MathJax_Preview">D</span><script type="math/tex">D</script></span> is the total derivative operator. So a good scheme is one step of backward convection by the method of Characteristics-Galerkin</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray}
\frac{1}{{\tau }}\left(u^{m + 1}(x) - u^m(X^m(x))\right) = f^m (x)
\label{eqn::Charac}
\end{eqnarray}</div>
<script type="math/tex; mode=display">\begin{eqnarray}
\frac{1}{{\tau }}\left(u^{m + 1}(x) - u^m(X^m(x))\right) = f^m (x)
\label{eqn::Charac}
\end{eqnarray}</script>
</div>
<p>where <span><span class="MathJax_Preview">X^m (x)</span><script type="math/tex">X^m (x)</script></span> is an approximation of the solution at $t = m\tau $ of the ordinary differential equation</p>
<div>
<div class="MathJax_Preview">
\frac{d\mathbf{X}}{dt}(t) = \mathbf{\alpha}^m(\mathbf{X}(t)),\, \mathbf{X}((m + 1)\tau ) = x.
</div>
<script type="math/tex; mode=display">
\frac{d\mathbf{X}}{dt}(t) = \mathbf{\alpha}^m(\mathbf{X}(t)),\, \mathbf{X}((m + 1)\tau ) = x.
</script>
</div>
<p>where <span><span class="MathJax_Preview">\mathbf{\alpha}^m(x)=(\alpha_1(x,m\tau ),\alpha_2(x,m\tau))</span><script type="math/tex">\mathbf{\alpha}^m(x)=(\alpha_1(x,m\tau ),\alpha_2(x,m\tau))</script></span>. Because, by Taylor's expansion, we have</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray}
u^m(\mathbf{X}(m\tau ))&amp;=&amp;
u^m(\mathbf{X}((m+1)\tau )) -
\tau \sum_{i=1}^d \frac{\p u^m}{\p x_i}(\mathbf{X}((m+1)\tau ))
\frac{\p X_i}{\p t}((m+1)\tau )
+o(\tau )\nonumber\\
&amp;=&amp;u^m(x)-\tau \mathbf{\alpha}^m(x)\cdot \nabla u^m(x)+o(\tau )
\label{eqn::conv1}
\end{eqnarray}</div>
<script type="math/tex; mode=display">\begin{eqnarray}
u^m(\mathbf{X}(m\tau ))&=&
u^m(\mathbf{X}((m+1)\tau )) -
\tau \sum_{i=1}^d \frac{\p u^m}{\p x_i}(\mathbf{X}((m+1)\tau ))
\frac{\p X_i}{\p t}((m+1)\tau )
+o(\tau )\nonumber\\
&=&u^m(x)-\tau \mathbf{\alpha}^m(x)\cdot \nabla u^m(x)+o(\tau )
\label{eqn::conv1}
\end{eqnarray}</script>
</div>
<p>where <span><span class="MathJax_Preview">X_i(t)</span><script type="math/tex">X_i(t)</script></span> are the i-th component of <span><span class="MathJax_Preview">\mathbf{X}(t)</span><script type="math/tex">\mathbf{X}(t)</script></span>, <span><span class="MathJax_Preview">u^m(x)=u(x,m\tau )</span><script type="math/tex">u^m(x)=u(x,m\tau )</script></span> and we used the chain rule and <span><span class="MathJax_Preview">x=\mathbf{X}((m+1)\tau )</span><script type="math/tex">x=\mathbf{X}((m+1)\tau )</script></span>. From \eqref{eqn::conv1}, it follows that</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray}
u^m(X^m(x))=u^m(x)-\tau \mathbf{\alpha}^m(x)\cdot \nabla u^m(x)+o(\tau ).
\end{eqnarray}</div>
<script type="math/tex; mode=display">\begin{eqnarray}
u^m(X^m(x))=u^m(x)-\tau \mathbf{\alpha}^m(x)\cdot \nabla u^m(x)+o(\tau ).
\end{eqnarray}</script>
</div>
<p>Also we apply Taylor's expansion for $t\mapsto u^m(x-\mathbf{\alpha}^m(x)t),\, 0\le t\le \tau $, then</p>
<div>
<div class="MathJax_Preview">
u^m(x-\mathbf{\alpha}\tau )=u^m(x)-\tau \mathbf{\alpha}^m(x)\cdot \nabla u^m(x)+o(\tau ).
</div>
<script type="math/tex; mode=display">
u^m(x-\mathbf{\alpha}\tau )=u^m(x)-\tau \mathbf{\alpha}^m(x)\cdot \nabla u^m(x)+o(\tau ).
</script>
</div>
<p>Putting</p>
<p><code class="codehilite"><span class="nf">convect</span></code> <span><span class="MathJax_Preview">\left( {\mathbf{\alpha},-\tau ,u^m } \right)\approx u^m \left(x - \mathbf{\alpha}^m\tau \right)</span><script type="math/tex">\left( {\mathbf{\alpha},-\tau ,u^m } \right)\approx u^m \left(x - \mathbf{\alpha}^m\tau \right)</script></span></p>
<p>we can get the approximation</p>
<p><span><span class="MathJax_Preview">u^m \left( {X^m( x )} \right) \approx</span><script type="math/tex">u^m \left( {X^m( x )} \right) \approx</script></span> <code class="codehilite"><span class="nf">convect</span></code> <span><span class="MathJax_Preview">\left( {[a_1^m ,a_2^m],-\tau ,u^m } \right)</span><script type="math/tex">\left( {[a_1^m ,a_2^m],-\tau ,u^m } \right)</script></span> by <span><span class="MathJax_Preview">X^m \approx x \mapsto x- \tau [a_1^m(x) ,a_2^m(x)]</span><script type="math/tex">X^m \approx x \mapsto x- \tau [a_1^m(x) ,a_2^m(x)]</script></span></p>
<p>A classical convection problem is that of the "rotating bell" (quoted from <a href="#LUCQUIN1998">LUCQUIN1998</a>, p.16).</p>
<p>Let <span><span class="MathJax_Preview">\Omega</span><script type="math/tex">\Omega</script></span> be the unit disk centered at 0, with its center rotating with speed <span><span class="MathJax_Preview">\alpha_1 = y,\, \alpha_2 = -x</span><script type="math/tex">\alpha_1 = y,\, \alpha_2 = -x</script></span>. We consider the problem \eqref{eqn::conv} with <span><span class="MathJax_Preview">f=0</span><script type="math/tex">f=0</script></span> and the initial condition <span><span class="MathJax_Preview">u(x,0)=u^0(x)</span><script type="math/tex">u(x,0)=u^0(x)</script></span>, that is, from \eqref{eqn::Charac}</p>
<p><span><span class="MathJax_Preview">u^{m + 1}(x) = u^m(X^m(x))\approx</span><script type="math/tex">u^{m + 1}(x) = u^m(X^m(x))\approx</script></span> <code class="codehilite"><span class="nf">convect</span></code><span><span class="MathJax_Preview">(\mathbf{\alpha},-\tau ,u^m)</span><script type="math/tex">(\mathbf{\alpha},-\tau ,u^m)</script></span></p>
<p>The exact solution is <span><span class="MathJax_Preview">u(x, t) = u(\mathbf{X}(t))</span><script type="math/tex">u(x, t) = u(\mathbf{X}(t))</script></span> where <span><span class="MathJax_Preview">\mathbf{X}</span><script type="math/tex">\mathbf{X}</script></span> equals <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> rotated around the origin by an angle <span><span class="MathJax_Preview">\theta = -t</span><script type="math/tex">\theta = -t</script></span> (rotate in clockwise). So, if <span><span class="MathJax_Preview">u^0</span><script type="math/tex">u^0</script></span> in a 3D perspective looks like a bell, then <span><span class="MathJax_Preview">u</span><script type="math/tex">u</script></span> will have exactly the same shape, but rotated by the same amount. The program consists in solving the equation until <span><span class="MathJax_Preview">T = 2\pi</span><script type="math/tex">T = 2\pi</script></span>, that is for a full revolution and to compare the final solution with the initial one; they should be equal.</p>
<div class="admonition example">
<p class="admonition-title">Convect</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// Parameters</span>
<span class="kt">real</span> <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.17</span><span class="p">;</span>

<span class="c1">// Mesh</span>
<span class="kt">border</span> <span class="nf">C</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">y</span><span class="o">=</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">);}</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">70</span><span class="p">));</span>

<span class="c1">// Fespace</span>
<span class="kt">fespace</span> <span class="nf">Vh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
<span class="n">Vh</span> <span class="n">u0</span><span class="p">;</span>
<span class="n">Vh</span> <span class="n">a1</span> <span class="o">=</span> <span class="o">-</span><span class="kr">y</span><span class="p">,</span> <span class="n">a2</span> <span class="o">=</span> <span class="kr">x</span><span class="p">;</span> <span class="c1">//rotation velocity</span>
<span class="n">Vh</span> <span class="n">u</span><span class="p">;</span>

<span class="c1">// Initialization</span>
<span class="n">u</span> <span class="o">=</span> <span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="o">*</span><span class="p">((</span><span class="kr">x</span><span class="o">-</span><span class="mf">0.3</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span><span class="p">(</span><span class="kr">y</span><span class="o">-</span><span class="mf">0.3</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="p">));</span>

<span class="c1">// Time loop</span>
<span class="kt">real</span> <span class="kp">t</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="kr">m</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="kr">m</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="o">/</span><span class="n">dt</span><span class="p">;</span> <span class="kr">m</span><span class="o">++</span><span class="p">){</span>
    <span class="c1">// Update</span>
    <span class="kp">t</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
    <span class="n">u0</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>

    <span class="c1">// Convect</span>
    <span class="n">u</span> <span class="o">=</span> <span class="nf">convect</span><span class="p">([</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">],</span> <span class="o">-</span><span class="n">dt</span><span class="p">,</span> <span class="n">u0</span><span class="p">);</span> <span class="c1">//u^{m+1}=u^m(X^m(x))</span>

    <span class="c1">// Plot</span>
    <span class="nf">plot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="kp">cmm</span><span class="o">=</span><span class="s">&quot; t=&quot;</span><span class="o">+</span><span class="kp">t</span><span class="o">+</span><span class="s">&quot;, min=&quot;</span><span class="o">+</span><span class="n">u</span><span class="p">[].</span><span class="kr">min</span><span class="o">+</span><span class="s">&quot;, max=&quot;</span><span class="o">+</span><span class="n">u</span><span class="p">[].</span><span class="kr">max</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The scheme <code class="codehilite"><span class="nf">convect</span></code> is unconditionally stable, then the bell become lower and lower (the maximum of <span><span class="MathJax_Preview">u^{37}</span><script type="math/tex">u^{37}</script></span> is <span><span class="MathJax_Preview">0.406</span><script type="math/tex">0.406</script></span> as shown in <a href="#Fig21">Fig. 21</a>).</p>
</div>
<table>
<thead>
<tr>
<th align="center"><a name="Fig20">Fig. 20</a>: <span><span class="MathJax_Preview">u^0=e^{-10((x-0.3)^2 +(y-0.3)^2)}</span><script type="math/tex">u^0=e^{-10((x-0.3)^2 +(y-0.3)^2)}</script></span></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="Convect" src="../images/EvolutionProblem_Convect.png" /></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th align="center"><a name="Fig21">Fig. 21</a>: The bell at <span><span class="MathJax_Preview">t=6.29</span><script type="math/tex">t=6.29</script></span></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="Convect2" src="../images/EvolutionProblem_Convect2.png" /></td>
</tr>
</tbody>
</table>
</div>
<h2 id="2d-black-scholes-equation-for-an-european-put-option">2D Black-Scholes equation for an European Put option<a class="headerlink" href="#2d-black-scholes-equation-for-an-european-put-option" title="Permanent link">#</a></h2>
<p>In mathematical finance, an option on two assets is modeled by a Black-Scholes equations in two space variables, (see for example <a href="#WILMOTT1995">WILMOTT1995</a> or <a href="#ACHDOU2005">ACHDOU2005</a>).</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray}
 &amp;&amp;\p _t u + \frac{{\left( {\sigma _1 x } \right)^2 }}{2}\frac{{\p ^2 u}}{{\p x^2 }} + \frac{{\left( {\sigma _2 y } \right)^2 }}{2}\frac{{\p ^2 u}}{{\p y^2 }} \\
 &amp;&amp;{\rm{ }} + \rho x y \frac{{\p ^2 u}}{{\p x \p y }} + rS_1 \frac{{\p u}}{{\p x }} + rS_2 \frac{{\p u}}{{\p y }} - rP = 0 \nonumber
\end{eqnarray}</div>
<script type="math/tex; mode=display">\begin{eqnarray}
 &&\p _t u + \frac{{\left( {\sigma _1 x } \right)^2 }}{2}\frac{{\p ^2 u}}{{\p x^2 }} + \frac{{\left( {\sigma _2 y } \right)^2 }}{2}\frac{{\p ^2 u}}{{\p y^2 }} \\
 &&{\rm{ }} + \rho x y \frac{{\p ^2 u}}{{\p x \p y }} + rS_1 \frac{{\p u}}{{\p x }} + rS_2 \frac{{\p u}}{{\p y }} - rP = 0 \nonumber
\end{eqnarray}</script>
</div>
<!--- __ --->

<p>which is to be integrated in <span><span class="MathJax_Preview">\left( {0,T} \right) \times \R^ + \times \R^ +</span><script type="math/tex">\left( {0,T} \right) \times \R^ + \times \R^ +</script></span> subject to, in the case of a put</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray}
u\left( {x , y ,T} \right) = \left( {K - \max \left( {x ,y } \right)} \right)^ +
\end{eqnarray}</div>
<script type="math/tex; mode=display">\begin{eqnarray}
u\left( {x , y ,T} \right) = \left( {K - \max \left( {x ,y } \right)} \right)^ +
\end{eqnarray}</script>
</div>
<p>Boundary conditions for this problem may not be so easy to device. As in the one dimensional case the PDE contains boundary conditions on the axis <span><span class="MathJax_Preview">x_1 = 0</span><script type="math/tex">x_1 = 0</script></span> and on the axis <span><span class="MathJax_Preview">x_2 = 0</span><script type="math/tex">x_2 = 0</script></span>, namely two one dimensional Black-Scholes equations driven respectively by the data <span><span class="MathJax_Preview">u\left( {0, + \infty ,T} \right)</span><script type="math/tex">u\left( {0, + \infty ,T} \right)</script></span> and <span><span class="MathJax_Preview">u\left( { + \infty ,0,T} \right)</span><script type="math/tex">u\left( { + \infty ,0,T} \right)</script></span>. These will be automatically accounted for because they are embedded in the PDE. So if we do nothing in the variational form (i.e. if we take a Neumann boundary condition at these two axis in the strong form) there will be no disturbance to these. At infinity in one of the variable, as in 1D, it makes sense to impose <span><span class="MathJax_Preview">u=0</span><script type="math/tex">u=0</script></span>. We take</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray}
\sigma _1  = 0.3,\;\;\sigma _2  = 0.3,\;\;\rho  = 0.3,\;\;r = 0.05,\;\;K = 40,\;\;T = 0.5
\end{eqnarray}</div>
<script type="math/tex; mode=display">\begin{eqnarray}
\sigma _1  = 0.3,\;\;\sigma _2  = 0.3,\;\;\rho  = 0.3,\;\;r = 0.05,\;\;K = 40,\;\;T = 0.5
\end{eqnarray}</script>
</div>
<!--- __ --->

<p>An implicit Euler scheme is used and a mesh adaptation is done every 10 time steps. To have an unconditionally stable scheme, the first order terms are treated by the Characteristic Galerkin method, which, roughly, approximates</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray}
\frac{{\p u}}{{\p t}} + a_1 \frac{{\p u}}{{\p x}} + a_2 \frac{{\p u}}{{\p y}} \approx \frac{1}{{\tau }}\left( {u^{n + 1} \left( x \right) - u^n \left( {x - \mathbf{\alpha}\tau } \right)} \right)
\end{eqnarray}</div>
<script type="math/tex; mode=display">\begin{eqnarray}
\frac{{\p u}}{{\p t}} + a_1 \frac{{\p u}}{{\p x}} + a_2 \frac{{\p u}}{{\p y}} \approx \frac{1}{{\tau }}\left( {u^{n + 1} \left( x \right) - u^n \left( {x - \mathbf{\alpha}\tau } \right)} \right)
\end{eqnarray}</script>
</div>
<div class="admonition example">
<p class="admonition-title">Black-Scholes</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// Parameters</span>
<span class="kt">int</span> <span class="kr">m</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">L</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">LL</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">sigx</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">sigy</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">rho</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">r</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">K</span> <span class="o">=</span> <span class="mi">40</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">;</span>

<span class="c1">// Mesh</span>
<span class="kt">mesh</span> <span class="n">th</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="kr">m</span><span class="p">,</span> <span class="kr">m</span><span class="p">,</span> <span class="p">[</span><span class="n">L</span><span class="o">*</span><span class="kr">x</span><span class="p">,</span> <span class="n">LL</span><span class="o">*</span><span class="kr">y</span><span class="p">]);</span>

<span class="c1">// Fespace</span>
<span class="kt">fespace</span> <span class="nf">Vh</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
<span class="n">Vh</span> <span class="n">u</span> <span class="o">=</span> <span class="kr">max</span><span class="p">(</span><span class="n">K</span><span class="o">-</span><span class="kr">max</span><span class="p">(</span><span class="kr">x</span><span class="p">,</span><span class="kr">y</span><span class="p">),</span><span class="mf">0.</span><span class="p">);</span>
<span class="n">Vh</span> <span class="n">xveloc</span><span class="p">,</span> <span class="n">yveloc</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">uold</span><span class="p">;</span>

<span class="c1">// Time loop</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="kr">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="kr">n</span><span class="o">*</span><span class="n">dt</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">;</span> <span class="kr">n</span><span class="o">++</span><span class="p">){</span>
    <span class="c1">// Mesh adaptation</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">){</span>
        <span class="n">th</span> <span class="o">=</span> <span class="nf">adaptmesh</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="kr">verbosity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">abserror</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">nbjacoby</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="kp">err</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="kp">nbvx</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="kp">omega</span><span class="o">=</span><span class="mf">1.8</span><span class="p">,</span> <span class="kp">ratio</span><span class="o">=</span><span class="mf">1.8</span><span class="p">,</span> <span class="kp">nbsmooth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="kp">splitpbedge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">maxsubdiv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="kp">rescaling</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">xveloc</span> <span class="o">=</span> <span class="o">-</span><span class="kr">x</span><span class="o">*</span><span class="n">r</span> <span class="o">+</span> <span class="kr">x</span><span class="o">*</span><span class="n">sigx</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="kr">x</span><span class="o">*</span><span class="n">rho</span><span class="o">*</span><span class="n">sigx</span><span class="o">*</span><span class="n">sigy</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
        <span class="n">yveloc</span> <span class="o">=</span> <span class="o">-</span><span class="kr">y</span><span class="o">*</span><span class="n">r</span> <span class="o">+</span> <span class="kr">y</span><span class="o">*</span><span class="n">sigy</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="kr">y</span><span class="o">*</span><span class="n">rho</span><span class="o">*</span><span class="n">sigx</span><span class="o">*</span><span class="n">sigy</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Update</span>
    <span class="n">uold</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>

    <span class="c1">// Solve</span>
    <span class="kt">solve</span> <span class="nf">eq1</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="kp">init</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">LU</span><span class="p">)</span>
        <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">th</span><span class="p">)(</span>
              <span class="n">u</span><span class="o">*</span><span class="n">v</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span>
            <span class="o">+</span> <span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="kr">x</span><span class="o">*</span><span class="n">sigx</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span>
            <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="kr">y</span><span class="o">*</span><span class="n">sigy</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span>
            <span class="o">+</span> <span class="p">(</span><span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">*</span><span class="n">rho</span><span class="o">*</span><span class="n">sigx</span><span class="o">*</span><span class="n">sigy</span><span class="o">*</span><span class="kr">x</span><span class="o">*</span><span class="kr">y</span><span class="o">/</span><span class="mi">2</span>
        <span class="p">)</span>
        <span class="o">-</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">th</span><span class="p">)(</span>
              <span class="n">v</span><span class="o">*</span><span class="nf">convect</span><span class="p">([</span><span class="n">xveloc</span><span class="p">,</span> <span class="n">yveloc</span><span class="p">],</span> <span class="n">dt</span><span class="p">,</span> <span class="n">uold</span><span class="p">)</span><span class="o">/</span><span class="n">dt</span>
        <span class="p">)</span>
        <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">;</span>

    <span class="c1">// Update</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// Plot</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">,</span> <span class="kp">value</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>Results are shown on <a href="#Fig21">Fig. 21</a>.</p>
<table>
<thead>
<tr>
<th align="center"><a name="Fig22">Fig. 22</a>: The adapted triangulation</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="BlackSholes" src="../images/EvolutionProblems_BlackSholes.png" /></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th align="center"><a name="Fig23">Fig. 23</a>: The level line of the European basquet put option</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="BlackSholes2" src="../images/EvolutionProblems_BlackSholes2.png" /></td>
</tr>
</tbody>
</table>
</div>
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">#</a></h2>
<p><a name="TABATA1994">[TABATA1994]</a> TABATA, M. Numerical solutions of partial differential equations II. Iwanami Applied Math, 1994.</p>
<p><a name="LUCQUIN1998">[LUCQUIN1998]</a> PIRONNEAU, O. et LUCQUIN-DESREUX, B. Introduction to scientific computing. Wiley, 1998.</p>
<p><a name="WILMOTT1995">[WILMOTT1995]</a> WILMOTT, Paul, HOWISON, Sam, et DEWYNNE, Jeff. A student introduction to mathematical finance. 1995.</p>
<p><a name="ACHDOU2005">[ACHDOU2005]</a> ACHDOU, Yves et PIRONNEAU, Olivier. Computational methods for option pricing. Siam, 2005.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../EigenValueProblems/" title="Eigenvalue problems" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Eigenvalue problems
              </span>
            </div>
          </a>
        
        
          <a href="../NavierStokesEquations/" title="Navier-Stokes equations" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Navier-Stokes equations
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/FreeFem/FreeFem-doc" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.9e1f3b71.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AMS_CHTML"></script>
      
        <script src="../../mathjax-config.js"></script>
      
    
    
      
    
  </body>
</html>